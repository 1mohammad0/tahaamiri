<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Ø·Ø§Ù‡Ø§ Ø§Ù…ÛŒØ±ÛŒ</title>
<style>
  body{font-family:sans-serif;background:#eef1f7;margin:0;padding:20px;direction:rtl}
  .container{max-width:900px;margin:0 auto}
  .card{background:#fff;padding:18px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,0.08);margin-bottom:16px;text-align:center}
  img{max-width:100%;border-radius:10px}
  .row{display:flex;gap:15px;flex-wrap:wrap;justify-content:space-between}
  .mini{flex:1 1 30%;background:#fff;border-radius:12px;padding:10px;box-shadow:0 4px 14px rgba(0,0,0,0.06)}
  .btn{padding:10px 16px;border-radius:8px;border:none;cursor:pointer;color:#fff;margin:6px}
  .like{background:#0d6efd}
  .dislike{background:#dc3545}
  .comments{margin-top:10px;text-align:right}
  .comment-card{background:#fff;padding:10px;border-radius:8px;margin-top:10px;box-shadow:0 2px 10px rgba(0,0,0,0.06);position:relative}
  .comment-actions{position:absolute;left:10px;top:10px}
  .comment-actions button{margin-left:6px;padding:6px;border-radius:6px;border:none;cursor:pointer}
  input[type="text"]{width:70%;padding:10px;border-radius:8px;border:1px solid #ccc}
  @media(max-width:700px){ .row{flex-direction:column} .mini{width:100%} }
</style>
</head>
<body>
  <div class="container">
    <!-- ÙˆØ³Ø· -->
    <div class="card">
      <img src="center.jpg" alt="Ø·Ø§Ù‡Ø§ Ø§Ù…ÛŒØ±ÛŒ">
      <h2>Ø·Ø§Ù‡Ø§ Ø§Ù…ÛŒØ±ÛŒ</h2>

      <div style="margin-top:10px">
        <button class="btn like" id="likeBtn">ğŸ‘ Ù„Ø§ÛŒÚ©</button>
        <button class="btn dislike" id="dislikeBtn">ğŸ‘ Ø¯ÛŒØ³â€ŒÙ„Ø§ÛŒÚ©</button>
      </div>

      <p>Ù„Ø§ÛŒÚ©: <span id="likes">0</span> â€” Ø¯ÛŒØ³Ù„Ø§ÛŒÚ©: <span id="dislikes">0</span></p>
    </div>

    <!-- Ú†Ù¾ Ùˆ Ø±Ø§Ø³Øª -->
    <div class="row">
      <div class="mini">
        <img src="left.jpg" alt="Ù†ÙˆØ´Ø§Ø¨Ù‡">
        <p>Ø¨Ù‡ Ø¯Ø±Ø®ÙˆØ§Ø³Øª Ø·Ø§Ù‡Ø§ Ø§Ù…ÛŒØ±ÛŒ Ù†ÙˆØ´Ø§Ø¨Ù‡â€ŒÛŒ Ø³ÛŒØ§Ù‡</p>
      </div>

      <div class="mini">
        <img src="right.jpg" alt="Ù…Ø§Ù„Ú©">
        <p>Ø·Ø§Ù‡Ø§ Ø§Ù…ÛŒØ±ÛŒ Ù…Ø§Ù„Ú© 90% Ø²Ù…ÛŒÙ†â€ŒÙ‡Ø§ÛŒ Ø§ÛŒØ±Ø§Ù†</p>
      </div>
    </div>

    <!-- Ù†Ø¸Ø±Ø§Øª -->
    <div class="card">
      <h3>Ø«Ø¨Øª Ù†Ø¸Ø±</h3>
      <div style="margin-top:10px">
        <input type="text" id="commentInput" placeholder="Ù†Ø¸Ø± Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯...">
        <button class="btn like" id="sendComment">Ø§Ø±Ø³Ø§Ù„</button>
      </div>

      <div id="comments" class="comments"></div>
    </div>
  </div>

<script>
  // ØªÙˆ Ø§ÛŒÙ†Ø¬Ø§ Ø§Ø² Ù…Ø³ÛŒØ±Ù‡Ø§ÛŒ Ù†Ø³Ø¨ÛŒ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡ â€” ÙˆÙ‚ØªÛŒ Ø±ÙˆÛŒ Render Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ù†ÛŒØŒ Ù‡Ù…ÛŒÙ† Ø¯Ø§Ù…Ù†Ù‡ Ø³Ø±ÙˆÛŒØ³â€ŒØ¯Ù‡ÛŒ Ù…ÛŒâ€ŒÚ©Ù†Ù‡.
  async function loadData(){
    try{
      const r = await fetch('/data');
      const data = await r.json();
      document.getElementById('likes').innerText = data.likes || 0;
      document.getElementById('dislikes').innerText = data.dislikes || 0;

      const commentsDiv = document.getElementById('comments');
      commentsDiv.innerHTML = '';
      (data.comments || []).forEach((c, i) => {
        const card = document.createElement('div');
        card.className = 'comment-card';
        card.innerHTML = `
          <div style="white-space:pre-wrap;">${escapeHtml(c.text)}</div>
        `;
        const actions = document.createElement('div');
        actions.className = 'comment-actions';
        // ÙˆÛŒØ±Ø§ÛŒØ´
        const editBtn = document.createElement('button');
        editBtn.innerText = 'ÙˆÛŒØ±Ø§ÛŒØ´';
        editBtn.style.background = '#198754';
        editBtn.style.color = 'white';
        editBtn.onclick = async () => {
          const newText = prompt('Ù…ØªÙ† Ø¬Ø¯ÛŒØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:', c.text);
          if (!newText) return;
          await fetch('/edit-comment', {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({ index: i, newText })
          });
          loadData();
        };
        // Ø­Ø°Ù
        const delBtn = document.createElement('button');
        delBtn.innerText = 'Ø­Ø°Ù';
        delBtn.style.background = '#dc3545';
        delBtn.style.color = 'white';
        delBtn.onclick = async () => {
          if (!confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ØŸ')) return;
          await fetch('/delete-comment', {
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body: JSON.stringify({ index: i })
          });
          loadData();
        };

        actions.appendChild(editBtn);
        actions.appendChild(delBtn);
        card.appendChild(actions);
        commentsDiv.appendChild(card);
      });
    }catch(e){
      console.error(e);
    }
  }

  // ÙØ±Ø§Ø± Ø§Ø² HTML Ø¯Ø± Ù…ØªÙ† Ù†Ø¸Ø±
  function escapeHtml(unsafe){
    return unsafe
      .replaceAll('&','&amp;')
      .replaceAll('<','&lt;')
      .replaceAll('>','&gt;')
      .replaceAll('"','&quot;')
      .replaceAll("'","&#039;");
  }

  document.getElementById('likeBtn').onclick = async () => {
    await fetch('/like', { method: 'POST' });
    loadData();
  };

  document.getElementById('dislikeBtn').onclick = async () => {
    await fetch('/dislike', { method: 'POST' });
    loadData();
  };

  document.getElementById('sendComment').onclick = async () => {
    const input = document.getElementById('commentInput');
    const text = input.value.trim();
    if (!text) return;
    await fetch('/comment', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ text })
    });
    input.value = '';
    loadData();
  };

  // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡
  loadData();
</script>
</body>
</html>

